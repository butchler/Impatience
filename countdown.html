<html>

<head>
<title>TurtleWeb Countdown</title>

<style type="text/css">
#countdown
{
  background-color: black;
  position: fixed;
  top: 0; left: 0;
  right: 0; bottom: 0;

  text-align: center;
  font-family: sans-serif;
  font-size: 18px;
  color: #666;

  padding-top: 150px;
}

#timeleft
{
  color: white;
  font-weight: bold;
  font-size: 100px;
}
</style>

<script type="text/javascript">
var countdownInterval;

function startCountdown()
{
  chrome.tabs.getCurrent(function (tab) {
    chrome.extension.sendRequest({ 'request': 'getCountdownInfo', 'tabId': tab.id }, function(countdownInfo) {
      if (countdownInfo != null)
      {
        var message = document.getElementById('message');
        message.innerHTML = 'You can use ' + countdownInfo.host + ' in:';
      }
    });
  });

  updateCountdown();
  countdownInterval = setInterval(updateCountdown, 1000);
}

function updateCountdown()
{
  chrome.tabs.getCurrent(function (tab) {
    chrome.extension.sendRequest({ 'request': 'getCountdownInfo', 'tabId': tab.id }, function(countdownInfo) {
      if (countdownInfo != null && countdownInfo.secondsLeft > 0)
      {
        var timeleft = document.getElementById('timeleft');
        timeleft.innerHTML = formatTime(countdownInfo.secondsLeft);
      }
      else if (countdownInterval)
      {
         clearInterval(countdownInterval);
      }
    });
  });
}

function formatTime(seconds)
{
  var minutes = Math.floor(seconds / 60);
  seconds = seconds % 60;
  return minutes + ':' + ((seconds < 10) ? '0' : '') + seconds;
}
</script>
</head>

<body onload="startCountdown();">
<div id="countdown"><div id="message"></div><div id="timeleft"></div></div>
</body>

</html>
