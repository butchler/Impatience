<html>
<script language="javascript">

function stripWWW(str)
{
  return str.replace(/^www\./, '');
}

// Initialize localStorage variables if they haven't been initialized yet
if (localStorage.blacklist == undefined)
   localStorage.blacklist = JSON.stringify('[]');
if (localStorage.secondsToWait == undefined)
   localStorage.secondsToWait = '300';

chrome.extension.onRequest.addListener(function(request, sender, sendResponse) {
  if (request.request == 'getSecondsToWait')
  {
    sendResponse(parseInt(localStorage.secondsToWait));
  }
  else if (request.request == 'redirect')
  {
    chrome.tabs.update(sender.tab.id, { url: request.url });
  }
  else if (request.request == 'isBlacklisted')
  {
    host = stripWWW(request.host);

    // Check if current URL is in blacklist
    blacklist = JSON.parse(localStorage.blacklist);
    for (i in blacklist)
    {
       if (host == blacklist[i])
       {
          console.log("Turtling host: " + request.host);
          sendResponse();
          break;
       }
    }
  }
});
</script>
</html>
